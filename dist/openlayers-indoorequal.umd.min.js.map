{"version":3,"file":"openlayers-indoorequal.umd.min.js","sources":["../src/layer.js","../src/level_control.js","../src/defaultstyle.js","../node_modules/debounce/index.js","../src/indoorequal.js","../src/levels.js"],"sourcesContent":["import Feature from 'ol/Feature';\nimport HeatmapLayer from 'ol/layer/Heatmap';\nimport MVT from 'ol/format/MVT';\nimport TileGrid from 'ol/tilegrid/TileGrid';\nimport TileJSON from 'ol/source/TileJSON';\nimport VectorSource from 'ol/source/Vector';\nimport VectorTileLayer from 'ol/layer/VectorTile';\nimport VectorTileSource from 'ol/source/VectorTile';\nimport { fromLonLat } from 'ol/proj';\nimport { tile } from 'ol/loadingstrategy';\n\nconst MIN_ZOOM_INDOOR = 17;\nconst MAX_ZOOM_HEATMAP = MIN_ZOOM_INDOOR;\n\nfunction extentFromTileJSON(tileJSON) {\n  const bounds = tileJSON.bounds;\n  if (bounds) {\n    const ll = fromLonLat([bounds[0], bounds[1]]);\n    const tr = fromLonLat([bounds[2], bounds[3]]);\n    return [ll[0], ll[1], tr[0], tr[1]];\n  }\n}\n\nconst defaultResolutions = (function () {\n  const resolutions = [];\n  for (let res = 78271.51696402048; resolutions.length <= 24; res /= 2) {\n    resolutions.push(res);\n  }\n  return resolutions;\n})();\n\nfunction createSourceFromTileJSON(tilejson) {\n  const tileJSONDoc = tilejson.getTileJSON();\n  const tiles = Array.isArray(tileJSONDoc.tiles)\n        ? tileJSONDoc.tiles\n        : [tileJSONDoc.tiles];\n  const tileGrid = tilejson.getTileGrid();\n  const extent = extentFromTileJSON(tileJSONDoc);\n  const minZoom = tileJSONDoc.minzoom;\n  const maxZoom = tileJSONDoc.maxzoom;\n  return new VectorTileSource({\n    attributions: tilejson.getAttributions(),\n    format: new MVT({\n      featureClass: Feature,\n    }),\n    tileGrid: new TileGrid({\n      origin: tileGrid.getOrigin(0),\n      extent: extent || tileGrid.getExtent(),\n      minZoom: minZoom,\n      resolutions: defaultResolutions.slice(0, maxZoom + 1),\n      tileSize: 512,\n    }),\n    urls: tiles,\n  });\n}\n\nfunction loadTileJSON(url) {\n  return new Promise((resolve, reject) => {\n    const tilejson = new TileJSON({ url });\n    tilejson.on('change', function () {\n      const state = tilejson.getState();\n      if (state === 'ready') {\n        resolve(tilejson);\n      }\n    });\n    if (tilejson.getState() === 'ready') {\n      tilejson.changed();\n    }\n  });\n}\n\nexport async function loadSourceFromTileJSON(url) {\n  const tilejson = await loadTileJSON(url);\n  return createSourceFromTileJSON(tilejson);\n}\n\nexport function getLayer(options) {\n  return new VectorTileLayer({\n    declutter: true,\n    ...options,\n  });\n}\n\nexport function createHeatmapSource(indoorLayer) {\n  const tilegrid = indoorLayer.getSource().getTileGrid();\n  const vectorSource = new VectorSource({\n    loader(extent, resolution, projection, success, failure) {\n      const refresh = () => {\n        const features = indoorLayer.getFeaturesInExtent(extent);\n        vectorSource.clear(true);\n        vectorSource.addFeatures(features);\n        success(features);\n      }\n      indoorLayer.getSource().on('tileloadend', refresh);\n      refresh();\n    },\n    loadingstrategy: tile(tilegrid)\n  });\n  return vectorSource;\n}\n\nexport function getHeatmapLayer(options) {\n  return new HeatmapLayer({\n    maxZoom: MAX_ZOOM_HEATMAP,\n    gradient: [\n      'rgba(102, 103, 173, 0)',\n      'rgba(102, 103, 173, 0.2)',\n      'rgba(102, 103, 173, 0.7)'\n    ],\n    ...options,\n  });\n}\n","import { Control } from 'ol/control';\n\n/**\n * A control to display the available levels\n * @param {IndoorEqual} indoorEqual the IndoorEqual instance\n * @param {Object} options\n * @param {string} [options.target] Specify a target if you want the control to be rendered outside of the map's viewport.\n * @return {LevelControl} `this`\n */\nexport default class LevelControl extends Control {\n  constructor(indoorEqual, options = {}) {\n    const element = document.createElement('div');\n    element.className = 'level-control ol-unselectable ol-control';\n    super({\n      element,\n      target: options.target,\n    });\n\n    this.indoorEqual = indoorEqual;\n    this._renderNewLevels();\n    this.indoorEqual.on('change:levels', this._renderNewLevels.bind(this));\n    this.indoorEqual.on('change:level', this._renderNewLevels.bind(this));\n  }\n\n  _renderNewLevels() {\n    this.element.innerHTML = '';\n    const currentLevel = this.indoorEqual.get('level');\n    this.indoorEqual.get('levels').forEach((level) => {\n      const button = document.createElement('button');\n      if (currentLevel === level) {\n        button.classList.add('level-control-active');\n      }\n      button.textContent = level;\n      button.addEventListener('click', () => {\n        this.indoorEqual.set('level', level);\n      })\n      this.element.appendChild(button);\n    });\n  }\n}\n","import { Fill, Stroke, Text, Icon, Style } from 'ol/style';\n\nfunction areaLayer(feature, resolution) {\n  const properties = feature.getProperties();\n  if (properties.class === 'level') {\n    return;\n  }\n  let color = '#fdfcfa';\n  if (properties.access && ['no', 'private'].includes(properties.access)) {\n    color = '#F2F1F0';\n  } else if (properties.is_poi && properties.class !== 'corridor') {\n    color = '#D4EDFF';\n  } else if (properties.class === 'room') {\n    color = '#fefee2';\n  }\n\n  let stroke;\n\n  if (['area', 'corridor', 'platform'].includes(properties.class)) {\n    stroke = new Stroke({\n      color: '#bfbfbf',\n      width: 1\n    });\n  }\n  if (properties.class === 'column') {\n    color = '#bfbfbf';\n  }\n  if (['room', 'wall'].includes(properties.class)) {\n    stroke = new Stroke({\n      color: 'gray',\n      width: 2\n    })\n  }\n\n  return new Style({\n    fill: new Fill({ color }),\n    stroke,\n  });\n}\n\nfunction transportationLayer(feature, resolution) {\n  return new Style({\n    stroke: new Stroke({\n      color: 'gray',\n      width: 2,\n      lineDash: [4, 7]\n    })\n  });\n}\n\nfunction areanameLayer(feature, resolution) {\n  return new Style({\n    text: new Text({\n      font: '13px Noto Sans Regular, sans-serif',\n      text: feature.getProperties().name,\n      fill: new Fill({ color: '#666' }),\n      stroke: new Stroke({\n        color: 'white',\n        width: 1\n      })\n    }),\n  });\n}\n\nfunction poiLayer(feature, resolution, map, sprite) {\n  const properties = feature.getProperties();\n  const zoom = map.getView().getZoomForResolution(resolution);\n  if (zoom < 19 && ['waste_basket', 'information', 'vending_machine'].includes(properties.class)) {\n    return;\n  }\n\n  let icon;\n  if (sprite) {\n    const iconDef = sprite.json['indoorequal-'+ properties.subclass] || sprite.json['indoorequal-'+ properties.class];\n\n    if (iconDef) {\n      icon = new Icon({\n        img: sprite.png,\n        size: [iconDef.width, iconDef.height],\n        offset: [iconDef.x, iconDef.y],\n      });\n    }\n  }\n\n  return new Style({\n    text: new Text({\n      font: '11px Noto Sans Regular, sans-serif',\n      text: properties.name,\n      fill: new Fill({ color: '#666' }),\n      offsetY: 18,\n      stroke: new Stroke({\n        color: 'white',\n        width: 1\n      })\n    }),\n    image: icon,\n  });\n}\n\nfunction loadAsImage(spriteImageUrl) {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.onload = function () {\n      img.onload = null;\n      resolve(img);\n    };\n    img.onerror = reject;\n    img.src = spriteImageUrl;\n  });\n}\n\nasync function loadSprite(basePath) {\n  const spriteScale = window.devicePixelRatio >= 1.5 ? 0.5 : 1;\n  const sizeFactor = spriteScale == 0.5 ? '@2x' : '';\n  let spriteUrl = basePath + sizeFactor + '.json';\n\n  const spriteJSON = await (await fetch(spriteUrl, {credentials: 'same-origin'})).json();\n  const spritePNG = await loadAsImage(basePath + sizeFactor + '.png', {credentials: 'same-origin'});\n\n  return { json: spriteJSON, png: spritePNG };\n}\n\nexport default function defaultStyle(map, layer, spriteBaseUrl) {\n  let sprite = null;\n  if (spriteBaseUrl) {\n    loadSprite(spriteBaseUrl)\n      .then((spriteData) => {\n        layer.changed();\n        sprite = spriteData;\n      });\n  }\n\n  return function(feature, resolution) {\n    const properties = feature.getProperties();\n    if (properties.layer === 'area') {\n      return areaLayer(feature, resolution);\n    }\n    if (properties.layer === 'transportation') {\n      return transportationLayer(feature, resolution);\n    }\n    if (properties.layer === 'area_name') {\n      return areanameLayer(feature, resolution);\n    }\n    if (properties.layer === 'poi') {\n      return poiLayer(feature, resolution, map, sprite);\n    }\n  }\n};\n","function debounce(function_, wait = 100, options = {}) {\n\tif (typeof function_ !== 'function') {\n\t\tthrow new TypeError(`Expected the first parameter to be a function, got \\`${typeof function_}\\`.`);\n\t}\n\n\tif (wait < 0) {\n\t\tthrow new RangeError('`wait` must not be negative.');\n\t}\n\n\t// TODO: Deprecate the boolean parameter at some point.\n\tconst {immediate} = typeof options === 'boolean' ? {immediate: options} : options;\n\n\tlet storedContext;\n\tlet storedArguments;\n\tlet timeoutId;\n\tlet timestamp;\n\tlet result;\n\n\tfunction run() {\n\t\tconst callContext = storedContext;\n\t\tconst callArguments = storedArguments;\n\t\tstoredContext = undefined;\n\t\tstoredArguments = undefined;\n\t\tresult = function_.apply(callContext, callArguments);\n\t\treturn result;\n\t}\n\n\tfunction later() {\n\t\tconst last = Date.now() - timestamp;\n\n\t\tif (last < wait && last >= 0) {\n\t\t\ttimeoutId = setTimeout(later, wait - last);\n\t\t} else {\n\t\t\ttimeoutId = undefined;\n\n\t\t\tif (!immediate) {\n\t\t\t\tresult = run();\n\t\t\t}\n\t\t}\n\t}\n\n\tconst debounced = function (...arguments_) {\n\t\tif (storedContext && this !== storedContext) {\n\t\t\tthrow new Error('Debounced method called with different contexts.');\n\t\t}\n\n\t\tstoredContext = this; // eslint-disable-line unicorn/no-this-assignment\n\t\tstoredArguments = arguments_;\n\t\ttimestamp = Date.now();\n\n\t\tconst callNow = immediate && !timeoutId;\n\n\t\tif (!timeoutId) {\n\t\t\ttimeoutId = setTimeout(later, wait);\n\t\t}\n\n\t\tif (callNow) {\n\t\t\tresult = run();\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tdebounced.clear = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(timeoutId);\n\t\ttimeoutId = undefined;\n\t};\n\n\tdebounced.flush = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tdebounced.trigger();\n\t};\n\n\tdebounced.trigger = () => {\n\t\tresult = run();\n\n\t\tdebounced.clear();\n\t};\n\n\treturn debounced;\n}\n\n// Adds compatibility for ES modules\nmodule.exports.debounce = debounce;\n\nmodule.exports = debounce;\n","import BaseObject from 'ol/Object';\nimport debounce from 'debounce';\n\nimport { loadSourceFromTileJSON, getLayer, getHeatmapLayer, createHeatmapSource } from './layer';\nimport findAllLevels from './levels';\nimport defaultStyle from './defaultstyle';\n\n/**\n * Load the indoor= source and layers in your map.\n * @param {Object} map the OpenLayers instance of the map\n * @param {Object} options\n * @param {boolean} [options.defaultStyle] False to not set the default style. Default true.\n * @param {string} [options.spriteBaseUrl] The base url of the sprite (without .json or .png). If not set, no sprite will be used in the default style.\n * @param {string} [options.url] Override the default tiles URL (https://tiles.indoorequal.org/).\n * @param {string} [options.apiKey] The API key if you use the default tile URL (get your free key at [indoorequal.com](https://indoorequal.com)).\n * @param {boolean} [options.heatmap] Should the heatmap layer be visible at start (true : visible, false : hidden). Defaults to true/visible.\n * @fires change:levels\n * @fires change:level\n * @return {IndoorEqual} `this`\n */\nexport default class IndoorEqual extends BaseObject {\n  constructor(map, options = {}) {\n    const defaultOpts = { url: 'https://tiles.indoorequal.org/', defaultStyle: true, spriteBaseUrl: null, heatmap: true };\n    const opts = { ...defaultOpts, ...options };\n    if (opts.url === defaultOpts.url && !opts.apiKey) {\n      throw 'You must register your apiKey at https://indoorequal.com before and set it as apiKey param.';\n    }\n    super({ levels: [], level: '0' });\n\n    this.map = map;\n    this.url = opts.url;\n    this.apiKey = opts.apiKey;\n\n    this._createLayers(opts.heatmap);\n    this._loadSource();\n    this.styleFunction = opts.defaultStyle ? defaultStyle(this.map, this.indoorLayer, opts.spriteBaseUrl) : null;\n    this._changeLayerOnLevelChange();\n    this._setLayerStyle();\n    this._resetLevelOnLevelsChange();\n  }\n\n  /**\n   * Set the style for displayed features. This function takes a feature and resolution and returns an array of styles. If set to null, the layer has no style (a null style), so only features that have their own styles will be rendered in the layer. Call setStyle() without arguments to reset to the default style. See module:ol/style for information on the default style.\n   * @param {function} styleFunction the style function\n   */\n  setStyle(styleFunction) {\n    this.styleFunction = styleFunction;\n  }\n\n  /**\n   * Change the heatmap layer visibility\n   * @param {boolean} visible True to make it visible, false to hide it\n   */\n  setHeatmapVisible(visible) {\n    this.heatmapLayer.setVisible(visible);\n  }\n\n  async _loadSource() {\n    const urlParams = this.apiKey ? `?key=${this.apiKey}` : '';\n    this.source = await loadSourceFromTileJSON(`${this.url}${urlParams}`);\n\n    this.indoorLayer.setSource(this.source);\n    this.heatmapLayer.setSource(createHeatmapSource(this.indoorLayer));\n    this._listenForLevels();\n  }\n\n  _createLayers(heatmapVisible) {\n    this.indoorLayer = getLayer();\n    this.heatmapLayer = getHeatmapLayer({ visible: heatmapVisible });\n    [this.indoorLayer, this.heatmapLayer].forEach((layer) => {\n      this.map.addLayer(layer);\n    });\n  }\n\n  _listenForLevels() {\n    const layer = this.indoorLayer;\n    const source = this.source;\n\n    const refreshLevels = debounce(() => {\n      const extent = this.map.getView().calculateExtent(this.map.getSize());\n      const features = layer.getFeaturesInExtent(extent);\n      this.set('levels', findAllLevels(features));\n    }, 1000);\n\n    source.on('tileloadend', () => refreshLevels());\n    this.map.getView().on('change:center', () => refreshLevels());\n  }\n\n  _changeLayerOnLevelChange() {\n    this.on('change:level', () => {\n      this.indoorLayer.changed();\n    });\n  }\n\n  _setLayerStyle() {\n    this.indoorLayer.setStyle((feature, resolution) => {\n      if (feature.getProperties().level === this.get('level')) {\n        return this.styleFunction && this.styleFunction(feature, resolution);\n      }\n    });\n  }\n\n  _resetLevelOnLevelsChange() {\n    this.on('change:levels', () => {\n      if (!this.get('levels').includes(this.get('level'))) {\n        this.set('level', '0');\n      }\n    });\n  }\n}\n\n/**\n * Emitted when the list of available levels has been updated\n *\n * @event IndoorEqual#change:levels\n * @type {Array}\n */\n\n/**\n * Emitted when the current level has been updated\n *\n * @event IndoorEqual#change:level\n * @type {string} always emitted when the level displayed has changed\n */\n","export default function findAllLevels(features) {\n  const levels = [];\n  for (let i = 0; i < features.length; i++) {\n    const feature = features[i];\n    const properties = feature.getProperties();\n    if (properties.layer !== 'area' || properties.class === 'level') {\n      continue;\n    }\n    const level = properties.level;\n    if (!levels.includes(level)) {\n      levels.push(level);\n    }\n  }\n  return levels.sort((a, b) => a - b).reverse();\n}\n"],"names":["defaultResolutions","resolutions","res","length","push","createSourceFromTileJSON","tilejson","tileJSONDoc","getTileJSON","tiles","Array","isArray","tileGrid","getTileGrid","extent","tileJSON","bounds","ll","fromLonLat","tr","extentFromTileJSON","minZoom","minzoom","maxZoom","maxzoom","VectorTileSource","attributions","getAttributions","format","MVT","featureClass","Feature","TileGrid","origin","getOrigin","getExtent","slice","tileSize","urls","async","loadSourceFromTileJSON","url","Promise","resolve","reject","TileJSON","on","getState","changed","loadTileJSON","getLayer","options","VectorTileLayer","declutter","getHeatmapLayer","HeatmapLayer","gradient","LevelControl","Control","constructor","indoorEqual","element","document","createElement","className","super","target","this","_renderNewLevels","bind","innerHTML","currentLevel","get","forEach","level","button","classList","add","textContent","addEventListener","set","appendChild","loadSprite","basePath","sizeFactor","window","devicePixelRatio","spriteUrl","spriteImageUrl","json","fetch","credentials","png","img","Image","crossOrigin","onload","onerror","src","defaultStyle","map","layer","spriteBaseUrl","sprite","then","spriteData","feature","resolution","properties","getProperties","class","stroke","color","access","includes","is_poi","Stroke","width","Style","fill","Fill","areaLayer","lineDash","text","Text","font","name","areanameLayer","getView","getZoomForResolution","icon","iconDef","subclass","Icon","size","height","offset","x","y","offsetY","image","poiLayer","debounce","function_","wait","TypeError","RangeError","immediate","storedContext","storedArguments","timeoutId","timestamp","result","run","callContext","callArguments","undefined","apply","later","last","Date","now","setTimeout","debounced","arguments_","Error","callNow","clear","clearTimeout","flush","trigger","debounceModule","exports","module","BaseObject","defaultOpts","heatmap","opts","apiKey","levels","_createLayers","_loadSource","styleFunction","indoorLayer","_changeLayerOnLevelChange","_setLayerStyle","_resetLevelOnLevelsChange","setStyle","setHeatmapVisible","visible","heatmapLayer","setVisible","urlParams","source","setSource","tilegrid","getSource","vectorSource","VectorSource","loader","projection","success","failure","refresh","features","getFeaturesInExtent","addFeatures","loadingstrategy","tile","createHeatmapSource","_listenForLevels","heatmapVisible","addLayer","refreshLevels","calculateExtent","getSize","i","sort","a","b","reverse","findAllLevels"],"mappings":"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","x_google_ignoreList":[3]}